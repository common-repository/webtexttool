var app=angular.module("wttDashboard",["angular-ladda","cgBusy"]);app.config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}]),app.controller("appController",["$scope","$http","$q","documentTypeService",function(o,r,a,n){o.error=null,o.message="Invalid Email or Password",o.loading=!1,o.loading2=!1,o.logo=wtt_admin_globals.pluginsUrl+"images/tm_logo.png",o.promiseTemplate=wtt_admin_globals.pluginsUrl+"partials/directives/loadingTemplate.html",o.promiseMessage="Please wait...";var s=wtt_admin_globals.wtt_base_api_url;o.WttAppUrl="https://app.textmetrics.com/#/",o.apiKey={value:""},o.loginModel={RememberMe:!0};function t(e){var n=a.defer();return r.get(e,{withCredentials:!0}).success(function(e,t,o,r){n.resolve(e)}).error(function(e,t){n.reject(e.Message)}),n.promise}function c(e,t){var o=a.defer();return jQuery.ajax({url:webtexttoolnonce.ajaxurl,type:"POST",dataType:"json",data:{action:webtexttoolnonce.action+e,nonce:webtexttoolnonce.nonce,data:t},success:function(e){o.resolve(e)},error:function(e,t,o){console.log(JSON.stringify(e)),console.log("AJAX error: "+t+" : "+o)}}),o.promise}o.saveApiKey=function(){o.loading2=!0;var e={apiKey:o.apiKey.value};localStorage.setItem("wtt_token",e.apiKey),c("",e).then(function(){location.reload()})},o.login=function(){var e,t,n;o.loading=!0,e=s+"user/login",t=o.loginModel,n=a.defer(),r.post(e,t,{withCredentials:!0}).success(function(e,t,o,r){n.resolve(e)}).error(function(e,t){n.reject(e.Message),o.error=e.Message,o.loading=!1,o.loading2=!1}),n.promise.then(function(e){e?(e={accessToken:e.access_token},localStorage.setItem("wtt_token",e.accessToken),c("",e).then(function(){location.reload()})):(o.loading=!1,o.error=o.message)})},o.logout=function(){o.loading=!0;var e={accessToken:"",apiKey:""};t(s+"user/logout").then(function(){localStorage.removeItem("wtt_token"),c("",e).then(function(){location.reload()})})};var e,i;e=wtt_admin_globals.authcode,i=wtt_admin_globals.apiKey,null!==localStorage.getItem("wtt_token")&&""!==localStorage.getItem("wtt_token")||(""!==e&&null!==e&&localStorage.setItem("wtt_token",e),""!==i&&null!==i&&localStorage.setItem("wtt_token",i)),t(s+"user/authenticated").then(function(e){(o.auth=e)&&(o.accountPromise=t(s+"user/info").then(function(e){var t;o.userInfo=e,t=a.defer(),n.getDocumentTypes(o.userInfo.DefaultLanguageCode).then(function(e){return c("_doctypes",e).then(function(){t.resolve(e)}),t.promise}),o.displayTrialDays=function(e){return e<=0?"0":e}}))})}]),app.factory("documentTypeService",["$http","$q","httpService",function(e,t,r){var n=wtt_admin_globals.wtt_base_api_url;return{getDocumentTypes:function(e,t){var o="/project/GetLightDocumentTypes";return e&&(o=o+"?lang="+e),null!=t&&(o=o+"&showHidden="+t),r.getData(n+o)}}}]),app.factory("httpService",["$http","$q",function(o,r){return{getData:function(e){var n=r.defer();return o.get(e,{withCredentials:!0}).success(function(e,t,o,r){n.resolve(e)}).error(function(e,t){401!==t&&(500!==t?n.reject(e.Message):console.error('Please contact us at <a href="mailto:support@textmetrics.com">support@textmetrics.com</a> Something went wrong while retrieving the data!'))}),n.promise},postData:function(e,t){var n=r.defer();return o.post(e,t,{withCredentials:!0}).success(function(e,t,o,r){n.resolve(e)}).error(function(e,t){400!==t?401!==t?403!==t?(500===t&&(console.error('Please contact us at <a href="mailto:support@textmetrics.com">support@textmetrics.com</a> Something went wrong!'),n.reject(e.Message)),n.reject(e.Message)):console.error('Please contact us at <a href="mailto:support@textmetrics.com">support@textmetrics.com</a> Access denied ('+t+")"):console.error(e.Message+" Unauthorized"):console.error("Your request params are empty or invalid! Bad Request")}),n.promise}}}]),app.factory("authInterceptor",["$q",function(t){return{request:function(e){return 0<e.url.indexOf(wtt_admin_globals.wtt_short_url)&&(e.headers=e.headers||{},e.headers.Authorization="Bearer "+localStorage.getItem("wtt_token"),e.headers.WttSource="WordPress"),e},response:function(e){return e||t.when(e)}}}]);